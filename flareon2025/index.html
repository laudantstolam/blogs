<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/png" href="/blogs/icon.png"><meta name="generator" content="Astro v5.1.1"><!-- Fonts --><!-- Font styles --><!-- Preload font files --><link rel="preload" href="/blogs/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/blogs/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://laudantstolam.github.io/blogs/flareon2025/"><!-- Primary Meta Tags --><title>Flare-on 2025 Writeup</title><meta name="title" content="Flare-on 2025 Writeup"><meta name="description" content="我好菜不會逆向QQ"><meta name="keywords" content="writeup, reverse"><!-- Robots Meta Tags --><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://laudantstolam.github.io/blogs/flareon2025/"><meta property="og:title" content="Flare-on 2025 Writeup"><meta property="og:description" content="我好菜不會逆向QQ"><meta property="og:image" content="https://laudantstolam.github.io/blogs/flareon2025/null"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://laudantstolam.github.io/blogs/flareon2025/"><meta property="twitter:title" content="Flare-on 2025 Writeup"><meta property="twitter:description" content="我好菜不會逆向QQ"><meta property="twitter:image" content="https://laudantstolam.github.io/blogs/flareon2025/null"><!-- KaTeX CSS for LaTeX rendering --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><link rel="stylesheet" href="/blogs/_astro/_slug_.BoP3nyfm.css">
<link rel="stylesheet" href="/blogs/_astro/_slug_.DnqyYaEC.css">
<link rel="stylesheet" href="/blogs/_astro/_slug_.BTl8ac6U.css">
<style>[data-astro-image]{width:100%;height:auto;-o-object-fit:var(--fit);object-fit:var(--fit);-o-object-position:var(--pos);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <div class="nav-wrapper" data-astro-cid-3ef6ksr2> <!-- <div class="nav-brand">
				<a href={getUrl('/')} class="brand-link">
					<div class="brand-icon">
						<img src={getUrl('/icon.png')} alt="icon logo" width="24" height="24" />
					</div>
					<span class="brand-text">{SITE_TITLE}</span>
				</a>
			</div> --> <div class="nav-links" data-astro-cid-3ef6ksr2> <a href="/blogs/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Home </a>  <a href="/blogs/blog" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/blogs/projects" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Projects </a>  </div> <div class="nav-actions" data-astro-cid-3ef6ksr2> <button id="theme-toggle" class="theme-toggle" title="Toggle theme" aria-label="Toggle theme" data-astro-cid-x3pjskd3> <svg width="20" height="20" viewBox="0 0 24 24" class="sun-icon" data-astro-cid-x3pjskd3> <path fill="currentColor" d="M12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12C18 15.3137 15.3137 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.51472 4.92893L4.92893 3.51472L7.05025 5.63604L5.63604 7.05025L3.51472 4.92893ZM16.9497 18.364L18.364 16.9497L20.4853 19.0711L19.0711 20.4853L16.9497 18.364ZM19.0711 3.51472L20.4853 4.92893L18.364 7.05025L16.9497 5.63604L19.0711 3.51472ZM5.63604 16.9497L7.05025 18.364L4.92893 20.4853L3.51472 19.0711L5.63604 16.9497ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z" data-astro-cid-x3pjskd3></path> </svg> <svg width="20" height="20" viewBox="0 0 24 24" class="moon-icon" data-astro-cid-x3pjskd3> <path fill="currentColor" d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.94174 4 12Z" data-astro-cid-x3pjskd3></path> </svg> </button>  <script type="module">const m=document.getElementById("theme-toggle");function t(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)}function o(){const n=(document.documentElement.getAttribute("data-theme")||"dark")==="light"?"dark":"light";t(n)}function d(){const e=localStorage.getItem("theme");t(e||"dark")}m?.addEventListener("click",o);document.addEventListener("DOMContentLoaded",d);window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||t("dark")});</script> <a href="https://github.com/laudantstolam" target="_blank" class="social-link" aria-label="GitHub" data-astro-cid-3ef6ksr2> <svg viewBox="0 0 16 16" aria-hidden="true" data-astro-cid-3ef6ksr2> <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path> </svg> </a> </div> </div> </nav> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2025-10-26T00:00:00.000Z"> Oct 26, 2025 </time>  </div> <h1 data-astro-cid-bvzihdzo>Flare-on 2025 Writeup</h1>  <div class="tags" data-astro-cid-bvzihdzo> <a href="/blogs/tag/writeup/" class="tag" data-astro-cid-bvzihdzo>#writeup</a><a href="/blogs/tag/reverse/" class="tag" data-astro-cid-bvzihdzo>#reverse</a> </div>  </div> <!-- Table of Contents --> <aside class="toc-wrapper" id="toc-wrapper" data-astro-cid-bvzihdzo> <div class="toc-header" data-astro-cid-bvzihdzo> <div class="toc-title" data-astro-cid-bvzihdzo> <span data-astro-cid-bvzihdzo>👀</span> <button class="toc-minimize-btn" id="toc-minimize-btn" aria-label="Toggle TOC" data-astro-cid-bvzihdzo> <span id="toc-icon" data-astro-cid-bvzihdzo>−</span> </button> </div> </div> <div class="toc-content" data-astro-cid-bvzihdzo> <ul class="toc-list" id="toc-list" data-astro-cid-bvzihdzo></ul> </div> </aside>  




















<table><thead><tr><th align="left"><font color="#c0504d">total</font></th><th align="left">Reverse</th><th align="left">Pwn</th><th align="left">Web</th><th align="left">Crypto</th><th align="left">Misc/Forensic</th></tr></thead><tbody><tr><td align="left"></td><td align="left">V</td><td align="left"></td><td align="left"></td><td align="left"></td><td align="left"></td></tr></tbody></table>



























































<table><thead><tr><th align="left">challenge</th><th align="left">difficulty</th><th>genere</th><th>GPT-able</th></tr></thead><tbody><tr><td align="left">01</td><td align="left">💔</td><td>pygame</td><td>V</td></tr><tr><td align="left">02</td><td align="left">💔</td><td>python opcode</td><td>V</td></tr><tr><td align="left">03</td><td align="left">💔</td><td>pdf misc</td><td>V</td></tr><tr><td align="left">04</td><td align="left">💔</td><td>header repair</td><td>0.5+通靈</td></tr><tr><td align="left">05(進度70%)</td><td align="left">💔💔💔</td><td>dbg and abs</td><td>0.2?</td></tr><tr><td align="left">06</td><td align="left">tbc</td><td></td><td></td></tr><tr><td align="left">07</td><td align="left">tbc</td><td></td><td></td></tr><tr><td align="left">08</td><td align="left">tbc</td><td></td><td></td></tr></tbody></table>
<p>上課上到一半被autong抓來打flare-on
這是google secure team每年會出的CTF題目 體感每一題都是可以延伸然後學到一些實用知識的酷題目
今年第一次打 感覺很有趣 學到很多不一樣的rev技巧</p>
<p><img src="https://raw.githubusercontent.com/Ash0645/image_remote/main/20251025123338.png" alt="image.png|300">
:D</p>
<h2 id="reverse">Reverse</h2>
<h3 id="01">01</h3>
<p>是一個酷酷Pygame, 往下鑽會鑽到flag的概念w</p>
<details data-callout="" data-callout-type="quote" open>
<summary data-callout-title="">challenge</summary>
<div data-callout-body="">
<p><img src="https://raw.githubusercontent.com/Ash0645/image_remote/main/20251025124037.png" alt="image.png|300"></p>
<div class="expressive-code"><link rel="stylesheet" href="/blogs/_astro/ec.0niu6.css"><script type="module" src="/blogs/_astro/ec.8zarh.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">GenerateFlagText</span><span style="--0:#E1E4E8;--1:#24292E">(sum):</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">   </span></span><span style="--0:#E1E4E8;--1:#24292E">key </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">sum</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">>></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">8</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">   </span></span><span style="--0:#E1E4E8;--1:#24292E">encoded </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">\xd0\xc7\xdf\xdb\xd4\xd0\xd4\xdc\xe3\xdb\xd1\xcd\x9f\xb5\xa7\xa7\xa0\xac\xa3\xb4\x88\xaf\xa6\xaa\xbe\xa8\xe3\xa0\xbe\xff\xb1\xbc\xb9</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">   </span></span><span style="--0:#E1E4E8;--1:#24292E">plaintext </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> []</span></div></div><div class="ec-line"><div class="code"><span class="indent">   </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(encoded)):</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">       </span></span><span style="--0:#E1E4E8;--1:#24292E">plaintext.append(</span><span style="--0:#79B8FF;--1:#005CC5">chr</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">ord</span><span style="--0:#E1E4E8;--1:#24292E">(encoded[i]) </span><span style="--0:#F97583;--1:#BF3441">^</span><span style="--0:#E1E4E8;--1:#24292E"> (key</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">i)))</span></div></div><div class="ec-line"><div class="code"><span class="indent">   </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">''</span><span style="--0:#E1E4E8;--1:#24292E">.join(plaintext)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="def GenerateFlagText(sum):   key = sum >> 8   encoded = &#x22;\xd0\xc7\xdf\xdb\xd4\xd0\xd4\xdc\xe3\xdb\xd1\xcd\x9f\xb5\xa7\xa7\xa0\xac\xa3\xb4\x88\xaf\xa6\xaa\xbe\xa8\xe3\xa0\xbe\xff\xb1\xbc\xb9&#x22;   plaintext = []   for i in range(0, len(encoded)):       plaintext.append(chr(ord(encoded[i]) ^ (key+i)))   return &#x27;&#x27;.join(plaintext)"><div></div></button></div></figure></div>
<p>有個驗證flag的func，傳入的東西是每次鑽到熊的時候的x值 (<code>Loc</code>)</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> player.hitBear():</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">               </span></span><span style="--0:#E1E4E8;--1:#24292E">player.drill.retract()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">               </span></span><span style="--0:#E1E4E8;--1:#24292E">bear_sum </span><span style="--0:#F97583;--1:#BF3441">*=</span><span style="--0:#E1E4E8;--1:#24292E"> player.x</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">               </span></span><span style="--0:#E1E4E8;--1:#24292E">bear_mode </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">True</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> bear_mode:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">screen.blit(bearimage, (player.rect.x, screen_height </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> tile_size))</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> current_level </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(LevelNames) </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">and</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> victory_mode:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">victory_mode </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">True</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">flag_text </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> GenerateFlagText(bear_sum)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"Your Flag: "</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> flag_text)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="if player.hitBear():               player.drill.retract()               bear_sum *= player.x               bear_mode = Trueif bear_mode:  screen.blit(bearimage, (player.rect.x, screen_height - tile_size))  if current_level == len(LevelNames) - 1 and not victory_mode:    victory_mode = True    flag_text = GenerateFlagText(bear_sum)    print(&#x22;Your Flag: &#x22; + flag_text)"><div></div></button></div></figure></div>
<p>熊會出現在<code>X=len(LevelNames[current_level])</code>的地方
<code>LevelNames</code>分別是 <code>['California','Ohio','Death Valley','Mexico','The Grand Canyon']</code></p>
</div>
</details>
<details data-callout="" data-callout-type="slove" open>
<summary data-callout-title="">solution</summary>
<div data-callout-body="">
<p>所以就把length乘過去丟到<code>GenerateFlag</code>就好</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">## copy paste from src code</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">GenerateFlagText</span><span style="--0:#E1E4E8;--1:#24292E">(sum_value):</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">   </span></span><span style="--0:#E1E4E8;--1:#24292E">key </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> sum_value </span><span style="--0:#F97583;--1:#BF3441">>></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">8</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">   </span></span><span style="--0:#E1E4E8;--1:#24292E">encoded </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">\xd0\xc7\xdf\xdb\xd4\xd0\xd4\xdc\xe3\xdb\xd1\xcd\x9f\xb5\xa7\xa7\xa0\xac\xa3\xb4\x88\xaf\xa6\xaa\xbe\xa8\xe3\xa0\xbe\xff\xb1\xbc\xb9</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">   </span></span><span style="--0:#E1E4E8;--1:#24292E">plaintext </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> []</span></div></div><div class="ec-line"><div class="code"><span class="indent">   </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(encoded)):</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">       </span></span><span style="--0:#E1E4E8;--1:#24292E">plaintext.append(</span><span style="--0:#79B8FF;--1:#005CC5">chr</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">ord</span><span style="--0:#E1E4E8;--1:#24292E">(encoded[i]) </span><span style="--0:#F97583;--1:#BF3441">^</span><span style="--0:#E1E4E8;--1:#24292E"> (key </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> i)))</span></div></div><div class="ec-line"><div class="code"><span class="indent">   </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">.join(plaintext)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">bear_sum </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> name </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> [</span><span style="--0:#9ECBFF;--1:#032F62">"California"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Ohio"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Death Valley"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Mexico"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"The Grand Canyon"</span><span style="--0:#E1E4E8;--1:#24292E">]:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">   </span></span><span style="--0:#E1E4E8;--1:#24292E">bear_sum </span><span style="--0:#F97583;--1:#BF3441">*=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(name)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(GenerateFlagText(bear_sum))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="## copy paste from src codedef GenerateFlagText(sum_value):   key = sum_value >> 8   encoded = &#x22;\xd0\xc7\xdf\xdb\xd4\xd0\xd4\xdc\xe3\xdb\xd1\xcd\x9f\xb5\xa7\xa7\xa0\xac\xa3\xb4\x88\xaf\xa6\xaa\xbe\xa8\xe3\xa0\xbe\xff\xb1\xbc\xb9&#x22;   plaintext = []   for i in range(len(encoded)):       plaintext.append(chr(ord(encoded[i]) ^ (key + i)))   return &#x22;&#x22;.join(plaintext)bear_sum = 1for name in [&#x22;California&#x22;, &#x22;Ohio&#x22;, &#x22;Death Valley&#x22;, &#x22;Mexico&#x22;, &#x22;The Grand Canyon&#x22;]:   bear_sum *= len(name)print(GenerateFlagText(bear_sum))"><div></div></button></div></figure></div>
</div>
</details>
<h3 id="02">02</h3>
<p>pyc 相關解壓縮</p>
<details data-callout="" data-callout-type="quote" open>
<summary data-callout-title="">challenge</summary>
<div data-callout-body="">
<p></p>
<p><code>encrypted_sequencer_data</code> -> zlib解壓 -> marshel執行
(<code>marshal</code>是python用來讀寫<code>pyc</code>的工具，將 <code>.py</code> → <code>.pyc</code>、或還原成可執行物件)</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> zlib</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> marshal</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972"># These are my encrypted instructions for the Sequencer.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">encrypted_sequencer_data </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">'x\....'</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"Booting up </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"Project Chimera"</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62"> from Dr. Khem's journal..."</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972"># Activate the Genetic Sequencer. From here, the process is automated.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">sequencer_code </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> zlib.decompress(encrypted_sequencer_data)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">### (EXTRACT sequencer_code)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">### print(sequencer_code)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">exec</span><span style="--0:#E1E4E8;--1:#24292E">(marshal.loads(sequencer_code))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import zlibimport marshal# These are my encrypted instructions for the Sequencer.encrypted_sequencer_data = b&#x27;x\....&#x27;print(f&#x22;Booting up {f&#x22;Project Chimera&#x22;} from Dr. Khem&#x27;s journal...&#x22;)# Activate the Genetic Sequencer. From here, the process is automated.sequencer_code = zlib.decompress(encrypted_sequencer_data)### (EXTRACT sequencer_code)### print(sequencer_code)exec(marshal.loads(sequencer_code))"><div></div></button></div></figure></div>
<p>然後 <code>sequencer_code</code>的結構如下</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">(HEADER)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">b"\xe3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00...</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">(BYTE CODE)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">c$|e+O>7&#x26;-6`m!Rzak~llE|2&#x3C;;!(^*VQn#qEH||......</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">(LOAD_CONST)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">--- Calibrating Genetic Sequencer ---....</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">(METADATA)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="(HEADER)b&#x22;\xe3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00...(BYTE CODE)c$|e+O>7&#x26;-6&#x60;m!Rzak~llE|2<;!(^*VQn#qEH||......(LOAD_CONST)--- Calibrating Genetic Sequencer ---....(METADATA)"><div></div></button></div></figure></div>
<p>那一大坨裡面有一些小線索(<code>LOAD_CONST</code>的內容)</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="pyc"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">--- Calibrating Genetic Sequencer ---</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">z\x1fDecoding catalyst DNA strand...</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">z\x1eSynthesizing Catalyst Serum...)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\x0f\xda\x06base64</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x04zlib</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x07marshal</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x05types</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x17encoded_catalyst_strand</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x05print</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\tb85decode</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x13compressed_catalyst</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\ndecompress</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x17marshalled_genetic_code</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x05loads</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x14catalyst_code_object</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x0cFunctionType</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x07globals</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">\xda\x1bcatalyst_injection_function\xa9\x00\xf3\x00\x00\x00\x00\xfa\x13&#x3C;genetic_sequencer>\xda\x08&#x3C;module></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="--- Calibrating Genetic Sequencer ---z\x1fDecoding catalyst DNA strand...z\x1eSynthesizing Catalyst Serum...)\x0f\xda\x06base64\xda\x04zlib\xda\x07marshal\xda\x05types\xda\x17encoded_catalyst_strand\xda\x05print\xda\tb85decode\xda\x13compressed_catalyst\xda\ndecompress\xda\x17marshalled_genetic_code\xda\x05loads\xda\x14catalyst_code_object\xda\x0cFunctionType\xda\x07globals\xda\x1bcatalyst_injection_function\xa9\x00\xf3\x00\x00\x00\x00\xfa\x13<genetic_sequencer>\xda\x08<module>"><div></div></button></div></figure></div>
<p>邏輯看起來是<code>base64</code>-> <code>zlib</code>-><code>marshal</code>-><code>encoded_catalyst_strand()</code> -> <code>base85</code> -> <code>zlib</code> -> <code>marshal</code>
((補充一下<code>types.FunctionType</code>是用來將 code object 包裝成 callable 函數))</p>
</div>
</details>
<details data-callout="" data-callout-type="slove" open>
<summary data-callout-title="">solution</summary>
<div data-callout-body="">
<p>逆推回去，先是第一層base85跟zlib的</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> base64</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> zlib</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> marshal</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">encoded </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"c$|e+O>7....Hooz%"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">decoded </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> base64.b85decode(encoded)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">decompressed </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> zlib.decompress(decoded)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">code </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> marshal.loads(decompressed)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972"># print(decompressed) --> 基本上這個丟到GPT就可以三秒解完了</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">dis.dis(code)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import base64import zlibimport marshalencoded = &#x22;c$|e+O>7....Hooz%&#x22;decoded = base64.b85decode(encoded)decompressed = zlib.decompress(decoded)code = marshal.loads(decompressed)# print(decompressed) --> 基本上這個丟到GPT就可以三秒解完了dis.dis(code)"><div></div></button></div></figure></div>
<p>這邊執行下去會噴錯: <code>IndexError: tuple index out of range</code>, 問了一下GPT說是py 3.13反組譯舊版本時候的格式錯誤 用<code>3.12</code>就可了</p>
<p>看了一下組譯出的東西</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">16</span><span style="--0:#E1E4E8;--1:#24292E">           </span><span style="--0:#79B8FF;--1:#005CC5">6</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_CONST</span><span style="--0:#E1E4E8;--1:#24292E">               </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">'m</span><span style="--0:#79B8FF;--1:#005CC5">\x1b</span><span style="--0:#9ECBFF;--1:#032F62">@I</span><span style="--0:#79B8FF;--1:#005CC5">\x1d</span><span style="--0:#9ECBFF;--1:#032F62">Aoe@</span><span style="--0:#79B8FF;--1:#005CC5">\x07</span><span style="--0:#9ECBFF;--1:#032F62">ZF[BL</span><span style="--0:#79B8FF;--1:#005CC5">\r</span><span style="--0:#9ECBFF;--1:#032F62">N</span><span style="--0:#79B8FF;--1:#005CC5">\n\x0c</span><span style="--0:#9ECBFF;--1:#032F62">S'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">             </span><span style="--0:#79B8FF;--1:#005CC5">8</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">STORE_FAST</span><span style="--0:#E1E4E8;--1:#24292E">               </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">LEAD_RESEARCHER_SIGNATURE</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">17</span><span style="--0:#E1E4E8;--1:#24292E">          </span><span style="--0:#79B8FF;--1:#005CC5">10</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_CONST</span><span style="--0:#E1E4E8;--1:#24292E">               </span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">'r2b-</span><span style="--0:#79B8FF;--1:#005CC5">\r\x9e\xf2\x1f</span><span style="--0:#9ECBFF;--1:#032F62">p</span><span style="--0:#79B8FF;--1:#005CC5">\x18</span><span style="--0:#9ECBFF;--1:#032F62">5</span><span style="--0:#79B8FF;--1:#005CC5">\x82\xcf\xfc\x90\x14\xf1</span><span style="--0:#9ECBFF;--1:#032F62">O</span><span style="--0:#79B8FF;--1:#005CC5">\xad</span><span style="--0:#9ECBFF;--1:#032F62">#]</span><span style="--0:#79B8FF;--1:#005CC5">\xf3\xe2\xc0</span><span style="--0:#9ECBFF;--1:#032F62">L</span><span style="--0:#79B8FF;--1:#005CC5">\xd0\xc1</span><span style="--0:#9ECBFF;--1:#032F62">e</span><span style="--0:#79B8FF;--1:#005CC5">\x0c\xea\xec\xae\x11</span><span style="--0:#9ECBFF;--1:#032F62">b</span><span style="--0:#79B8FF;--1:#005CC5">\xa7\x8c\xaa</span><span style="--0:#9ECBFF;--1:#032F62">!</span><span style="--0:#79B8FF;--1:#005CC5">\xa1\x9d\xc2\x90</span><span style="--0:#9ECBFF;--1:#032F62">'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#79B8FF;--1:#005CC5">12</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">STORE_FAST</span><span style="--0:#E1E4E8;--1:#24292E">               </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">ENCRYPTED_CHIMERA_FORMULA</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="16           6 LOAD_CONST               1 (b&#x27;m\x1b@I\x1dAoe@\x07ZF[BL\rN\n\x0cS&#x27;)             8 STORE_FAST               0 (LEAD_RESEARCHER_SIGNATURE)17          10 LOAD_CONST               2 (b&#x27;r2b-\r\x9e\xf2\x1fp\x185\x82\xcf\xfc\x90\x14\xf1O\xad#]\xf3\xe2\xc0L\xd0\xc1e\x0c\xea\xec\xae\x11b\xa7\x8c\xaa!\xa1\x9d\xc2\x90&#x27;)            12 STORE_FAST               1 (ENCRYPTED_CHIMERA_FORMULA)"><div></div></button></div></figure></div>
<p>上面的東西會用來呼叫<code>usersignerture</code>進行XOR後驗證</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">25</span><span style="--0:#E1E4E8;--1:#24292E">         </span><span style="--0:#79B8FF;--1:#005CC5">126</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_GLOBAL</span><span style="--0:#E1E4E8;--1:#24292E">              </span><span style="--0:#79B8FF;--1:#005CC5">9</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">NULL</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">bytes</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">136</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_CONST</span><span style="--0:#E1E4E8;--1:#24292E">               </span><span style="--0:#79B8FF;--1:#005CC5">5</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E">code </span><span style="--0:#79B8FF;--1:#005CC5">object</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E">genexpr</span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E"> at </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">000002A0BC7A4830</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">file</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"&#x3C;catalyst_core>"</span><span style="--0:#E1E4E8;--1:#24292E">, line </span><span style="--0:#79B8FF;--1:#005CC5">25</span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">138</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">MAKE_FUNCTION</span><span style="--0:#E1E4E8;--1:#24292E">            </span><span style="--0:#79B8FF;--1:#005CC5">0</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">140</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_GLOBAL</span><span style="--0:#E1E4E8;--1:#24292E">             </span><span style="--0:#79B8FF;--1:#005CC5">11</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">NULL</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">enumerate</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">150</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_FAST</span><span style="--0:#E1E4E8;--1:#24292E">                </span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E"> (current_user)</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">152</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">CALL</span><span style="--0:#E1E4E8;--1:#24292E">                     </span><span style="--0:#79B8FF;--1:#005CC5">1</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">160</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">GET_ITER</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">162</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">CALL</span><span style="--0:#E1E4E8;--1:#24292E">                     </span><span style="--0:#79B8FF;--1:#005CC5">0</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">170</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">CALL</span><span style="--0:#E1E4E8;--1:#24292E">                     </span><span style="--0:#79B8FF;--1:#005CC5">1</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">178</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">STORE_FAST</span><span style="--0:#E1E4E8;--1:#24292E">               </span><span style="--0:#79B8FF;--1:#005CC5">3</span><span style="--0:#E1E4E8;--1:#24292E"> (user_signature)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="25         126 LOAD_GLOBAL              9 (NULL + bytes)           136 LOAD_CONST               5 (<code object <genexpr> at 0x000002A0BC7A4830, file &#x22;<catalyst_core>&#x22;, line 25>)           138 MAKE_FUNCTION            0           140 LOAD_GLOBAL             11 (NULL + enumerate)           150 LOAD_FAST                2 (current_user)           152 CALL                     1           160 GET_ITER           162 CALL                     0           170 CALL                     1           178 STORE_FAST               3 (user_signature)"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">20</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_FAST</span><span style="--0:#E1E4E8;--1:#24292E">                </span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E"> (c)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">22</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_FAST</span><span style="--0:#E1E4E8;--1:#24292E">                </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> (i)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">24</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_CONST</span><span style="--0:#E1E4E8;--1:#24292E">               </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">42</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">26</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">BINARY_OP</span><span style="--0:#E1E4E8;--1:#24292E">                </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">30</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">BINARY_OP</span><span style="--0:#E1E4E8;--1:#24292E">               </span><span style="--0:#79B8FF;--1:#005CC5">12</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">^</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="20 LOAD_FAST                2 (c)22 LOAD_FAST                1 (i)24 LOAD_CONST               0 (42)26 BINARY_OP                0 (+)30 BINARY_OP               12 (^)"><div></div></button></div></figure></div>
<p>對應python<code>user_signature = bytes(c ^ (i + 42) for i, c in enumerate(current_user))</code></p>
<p>最後對 <code>current_user</code> 進行ARC4加密</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">37</span><span style="--0:#E1E4E8;--1:#24292E">         </span><span style="--0:#79B8FF;--1:#005CC5">354</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_GLOBAL</span><span style="--0:#E1E4E8;--1:#24292E">             </span><span style="--0:#79B8FF;--1:#005CC5">21</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">NULL</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">ARC4</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">364</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">LOAD_FAST</span><span style="--0:#E1E4E8;--1:#24292E">                </span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E"> (current_user)</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">366</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">CALL</span><span style="--0:#E1E4E8;--1:#24292E">                     </span><span style="--0:#79B8FF;--1:#005CC5">1</span></div></div><div class="ec-line"><div class="code"><span class="indent">           </span><span style="--0:#79B8FF;--1:#005CC5">374</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">STORE_FAST</span><span style="--0:#E1E4E8;--1:#24292E">               </span><span style="--0:#79B8FF;--1:#005CC5">5</span><span style="--0:#E1E4E8;--1:#24292E"> (arc4_decipher)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="37         354 LOAD_GLOBAL             21 (NULL + ARC4)           364 LOAD_FAST                2 (current_user)           366 CALL                     1           374 STORE_FAST               5 (arc4_decipher)"><div></div></button></div></figure></div>
<p>sol:
<code>user --XOR--> signature</code> 所以 <code>signature --XOR--> user </code></p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> arc4 </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">ARC4</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">LEAD_RESEARCHER_SIGNATURE</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">"m</span><span style="--0:#79B8FF;--1:#005CC5">\x1b</span><span style="--0:#9ECBFF;--1:#032F62">@I</span><span style="--0:#79B8FF;--1:#005CC5">\x1d</span><span style="--0:#9ECBFF;--1:#032F62">Aoe@</span><span style="--0:#79B8FF;--1:#005CC5">\x07</span><span style="--0:#9ECBFF;--1:#032F62">ZF[BL</span><span style="--0:#79B8FF;--1:#005CC5">\r</span><span style="--0:#9ECBFF;--1:#032F62">N</span><span style="--0:#79B8FF;--1:#005CC5">\n\x0c</span><span style="--0:#9ECBFF;--1:#032F62">S"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">ENCRYPTED_CHIMERA_FORMULA</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">"r2b-</span><span style="--0:#79B8FF;--1:#005CC5">\r\x9e\xf2\x1f</span><span style="--0:#9ECBFF;--1:#032F62">p</span><span style="--0:#79B8FF;--1:#005CC5">\x18</span><span style="--0:#9ECBFF;--1:#032F62">5</span><span style="--0:#79B8FF;--1:#005CC5">\x82\xcf\xfc\x90\x14\xf1</span><span style="--0:#9ECBFF;--1:#032F62">O</span><span style="--0:#79B8FF;--1:#005CC5">\xad</span><span style="--0:#9ECBFF;--1:#032F62">#]</span><span style="--0:#79B8FF;--1:#005CC5">\xf3\xe2\xc0</span><span style="--0:#9ECBFF;--1:#032F62">L</span><span style="--0:#79B8FF;--1:#005CC5">\xd0\xc1</span><span style="--0:#9ECBFF;--1:#032F62">e</span><span style="--0:#79B8FF;--1:#005CC5">\x0c\xea\xec\xae\x11</span><span style="--0:#9ECBFF;--1:#032F62">b</span><span style="--0:#79B8FF;--1:#005CC5">\xa7\x8c\xaa</span><span style="--0:#9ECBFF;--1:#032F62">!</span><span style="--0:#79B8FF;--1:#005CC5">\xa1\x9d\xc2\x90</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">## XOR current user</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">username </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">bytes</span><span style="--0:#E1E4E8;--1:#24292E">(c </span><span style="--0:#F97583;--1:#BF3441">^</span><span style="--0:#E1E4E8;--1:#24292E"> (i </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">42</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> i, c </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">enumerate</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">LEAD_RESEARCHER_SIGNATURE</span><span style="--0:#E1E4E8;--1:#24292E">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(username)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(ARC4(username).decrypt(</span><span style="--0:#79B8FF;--1:#005CC5">ENCRYPTED_CHIMERA_FORMULA</span><span style="--0:#E1E4E8;--1:#24292E">))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="from arc4 import ARC4LEAD_RESEARCHER_SIGNATURE = b&#x22;m\x1b@I\x1dAoe@\x07ZF[BL\rN\n\x0cS&#x22;ENCRYPTED_CHIMERA_FORMULA = b&#x22;r2b-\r\x9e\xf2\x1fp\x185\x82\xcf\xfc\x90\x14\xf1O\xad#]\xf3\xe2\xc0L\xd0\xc1e\x0c\xea\xec\xae\x11b\xa7\x8c\xaa!\xa1\x9d\xc2\x90&#x22;## XOR current userusername = bytes(c ^ (i + 42) for i, c in enumerate(LEAD_RESEARCHER_SIGNATURE))print(username)print(ARC4(username).decrypt(ENCRYPTED_CHIMERA_FORMULA))"><div></div></button></div></figure></div>
</div>
</details>
<details data-callout="" data-callout-type="note" open>
<summary data-callout-title="">延伸</summary>
<div data-callout-body="">
<p>在寫WP的時候多看了一下python的opcode結構(就是marshal出來的pyc檔案)
參考了這篇文章: <a href="https://www.buaq.net/go-9664.html">利用OpCode绕过Python沙箱 - 先知社区</a></p>
<p>可以用<code>dis.dis()</code>來解構pyc
以這題為例，用<code>dis.dis(marshal.loads(b"..."))</code>會拿到</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">0           BINARY_OP                0 (+)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">             </span></span><span style="--0:#e1e4e8;--1:#24292e">POP_JUMP_IF_TRUE         1 (to L1)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">             </span></span><span style="--0:#e1e4e8;--1:#24292e">LOAD_FROM_DICT_OR_GLOBALS 0 (base64)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">3   L1:     POP_JUMP_IF_TRUE         0 (to L2)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">     </span></span><span style="--0:#e1e4e8;--1:#24292e">L2:     STORE_ATTR               1 (zlib)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">             </span></span><span style="--0:#e1e4e8;--1:#24292e">LOAD_FROM_DICT_OR_GLOBALS 2 (marshal)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">5           POP_JUMP_IF_TRUE         0 (to L3)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">     </span></span><span style="--0:#e1e4e8;--1:#24292e">L3:     STORE_ATTR               3 (types)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">             </span></span><span style="--0:#e1e4e8;--1:#24292e">RAISE_VARARGS            5</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">             </span></span><span style="--0:#e1e4e8;--1:#24292e">POP_JUMP_IF_TRUE         3 (to L4)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=" 0           BINARY_OP                0 (+)             POP_JUMP_IF_TRUE         1 (to L1)             LOAD_FROM_DICT_OR_GLOBALS 0 (base64) 3   L1:     POP_JUMP_IF_TRUE         0 (to L2)     L2:     STORE_ATTR               1 (zlib)             LOAD_FROM_DICT_OR_GLOBALS 2 (marshal) 5           POP_JUMP_IF_TRUE         0 (to L3)     L3:     STORE_ATTR               3 (types)             RAISE_VARARGS            5             POP_JUMP_IF_TRUE         3 (to L4)..."><div></div></button></div></figure></div>
<p>然後可以去做進一步的分析</p>
</div>
</details>
<h3 id="03">03</h3>
<p>pdf misc</p>
<details data-callout="" data-callout-type="quote" open>
<summary data-callout-title="">challenge</summary>
<div data-callout-body="">
<p>拿到一個pdf 去看了一下string</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">%PDF-2.0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">%SNDHNRO0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">RE~^</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">% Hey there! Welcome to this source...</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">% Tested under the following browsers:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">% Chrome, Safari, PDFjs (Firefox)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">1       0       obj     &#x3C;&#x3C;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">% N0t_a_flag_but_just_a_line_comment</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">/Pages  2       0       R/Type/Catalog/Extensions       &#x3C;&#x3C;/ADBE &#x3C;&#x3C;/BaseVersion/1.7/ExtensionLevel       8>>>>>>endobj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">% 2 0 obj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">% &#x3C;&#x3C;>></span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">% endobj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">3 0 obj</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">/Contents 4 0 R</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">/Parent 2 0 R</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">/Resources 6 0 R</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">/Type /Page</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">/MediaBox [0 0 612 130]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">endobj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">2 0 obj</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">/Count 1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">/Kids [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">   </span></span><span style="--0:#e1e4e8;--1:#24292e">3 0 R</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e"> </span></span><span style="--0:#e1e4e8;--1:#24292e">/Type /Pages</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">endobj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">% 2 0 obj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">% &#x3C;&#x3C;>></span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">% endobj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">4 0 obj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&#x3C;&#x3C;/Length 320/Filter /FlateDecode>>stream</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="%PDF-2.0%SNDHNRO0RE~^% Hey there! Welcome to this source...% Tested under the following browsers:% Chrome, Safari, PDFjs (Firefox)1       0       obj     <<% N0t_a_flag_but_just_a_line_comment/Pages  2       0       R/Type/Catalog/Extensions       <</ADBE <</BaseVersion/1.7/ExtensionLevel       8>>>>>>endobj% 2 0 obj% <<>>% endobj3 0 obj /Contents 4 0 R /Parent 2 0 R /Resources 6 0 R /Type /Page /MediaBox [0 0 612 130]endobj2 0 obj /Count 1 /Kids [   3 0 R /Type /Pagesendobj% 2 0 obj% <<>>% endobj4 0 obj<</Length 320/Filter /FlateDecode>>stream..."><div></div></button></div></figure></div>
<p><code>/Pages  2 0 R</code> 這些地方看起來像是pdf pages 的壓縮</p>
</div>
</details>
<details data-callout="" data-callout-type="note" open>
<summary data-callout-title="">notes</summary>
<div data-callout-body="">
<p>邏輯是</p>
<ol>
<li>
<p>先解pdf壓縮的東西</p>
</li>
<li>
<p>然後看strings 看到一串ffd8ffe00… 轉換成jpeg</p>
</li>
<li>
<p>然後發現好像哪裡不對 是一坨東西而且exiftool說他是<code>1*37</code>的圖片</p>
</li>
<li>
<p>就把相素提取出來換成ASCII</p>
</li>
</ol>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">┌──(kali㉿kali</span><span style="--0:#E1E4E8;--1:#24292E">)-[/media/sf_SHARED_FILE/flareon/03]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">└─$</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">qpdf</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">--qdf</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">--object-streams=disable</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">pretty_devilish_file.pdf</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">step1.pdf</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="┌──(kali㉿kali)-[/media/sf_SHARED_FILE/flareon/03]└─$ qpdf --qdf --object-streams=disable pretty_devilish_file.pdf step1.pdf"><div></div></button></div></figure></div>
<p>再次strings</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">%PDF-2.0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">%QDF-1.0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">%% Original object ID: 1 0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">1 0 obj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&#x3C;SNIP></span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">2 0 obj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&#x3C;SNIP></span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">3 0 obj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&#x3C;SNIP></span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">4 0 obj</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&#x3C;SINP></span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">ffd8ffe000104a46494600010100000100010000ffdb00430001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101ffc0000b080001002501011100ffc40017000100030000000000000000000000000006040708ffc400241000000209050100000000000000000000000702050608353776b6b7030436747577ffda0008010100003f00c54d3401dcbbfb9c38db8a7dd265a2159e9d945a086407383aabd52e5034c274e57179ef3bcdfca50f0af80aff00e986c64568c7ffd9</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&#x3C;SNIP></span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">(Flare-On!)'</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">endstream</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">&#x3C;SNIP></span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">%%EOF</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="%PDF-2.0%QDF-1.0%% Original object ID: 1 01 0 obj<SNIP>2 0 obj<SNIP>3 0 obj<SNIP>4 0 obj<SINP>ffd8ffe000104a46494600010100000100010000ffdb00430001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101ffc0000b080001002501011100ffc40017000100030000000000000000000000000006040708ffc400241000000209050100000000000000000000000702050608353776b6b7030436747577ffda0008010100003f00c54d3401dcbbfb9c38db8a7dd265a2159e9d945a086407383aabd52e5034c274e57179ef3bcdfca50f0af80aff00e986c64568c7ffd9<SNIP>(Flare-On!)&#x27;endstream<SNIP>%%EOF"><div></div></button></div></figure></div>
<p>在第四個地方看到了ffd8…ffd9 一看就是JPEG
後面用exiftool 觀察</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Encoding Process                : Baseline DCT, Huffman coding</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Image Size                      : 37x1</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Encoding Process                : Baseline DCT, Huffman codingImage Size                      : 37x1"><div></div></button></div></figure></div>
<p>看一下pixels裡面的東西 感覺很ascii 於是就通靈出來了(</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">PIL</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> Image</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">img </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> Image.open(</span><span style="--0:#9ECBFF;--1:#032F62">'extracted.jpg'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">pixels </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">list</span><span style="--0:#E1E4E8;--1:#24292E">(img.getdata())</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">### print(pixels)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">## [80, 117, 122, 122, 108, 49, 110, 103, 45, 68, 51, 118, 105, 108, 105, 115, 104, 45, 70, 48, 114, 109, 97, 116, 64, 102, 108, 97, 114, 101, 45, 111, 110, 46, 99, 111, 109]</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">ascii_str </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">''</span><span style="--0:#E1E4E8;--1:#24292E">.join(</span><span style="--0:#79B8FF;--1:#005CC5">chr</span><span style="--0:#E1E4E8;--1:#24292E">(p) </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> p </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> pixels)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(ascii_str)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="from PIL import Imageimg = Image.open(&#x27;extracted.jpg&#x27;)pixels = list(img.getdata())### print(pixels)## [80, 117, 122, 122, 108, 49, 110, 103, 45, 68, 51, 118, 105, 108, 105, 115, 104, 45, 70, 48, 114, 109, 97, 116, 64, 102, 108, 97, 114, 101, 45, 111, 110, 46, 99, 111, 109]ascii_str = &#x27;&#x27;.join(chr(p) for p in pixels)print(ascii_str)"><div></div></button></div></figure></div>
</div>
</details>
<p>又是屬於通靈仔的勝利(
到這邊差不多過了30分鐘 然後後面開始一直通靈失敗QQ</p>
<h3 id="04">04</h3>
<p>這題其實很水(
其實好像五分鐘就做完了但是一直差最後一部所以跑去逆向twinbasic的東西花了一天🤡</p>
<details data-callout="" data-callout-type="quote" open>
<summary data-callout-title="">challenge</summary>
<div data-callout-body="">
<p></p>
<h4 id="修復檔案">修復檔案</h4>
<p>xxd 先看下發現他是 開頭是<code>15 5A</code>的EXE 所以要改成標準的header <code>4d 5a</code>
<code>printf '\x4D' | dd of=UnholyDragon-150.exe bs=1 seek=0 count=1 conv=notrunc</code>
這樣就正常了</p>
<h4 id="調查結構這邊可以跳過-純純小丑過程">調查結構(這邊可以跳過 純純小丑過程)</h4>
<p>然後開DIE看到
<code>(Heur)Packer: Compressed or packed data[High entropy + Section 1 (".data") compressed]</code>
然後因為執行下去會出現151.exe ~ 154.exe 所以懷疑了一下是多層嵌套的exe</p>
<p>用這邊來看MZ或是PE 的檔案結構
MZ開頭是4D5A -> <code>grep -aobP $'\x4d\x5a' UnholyDragon-150.exe</code>
PE開頭是450045 -> <code>grep -aobP $'\x50\x45\x00\x00' UnholyDragon-150.exe</code></p>
<p>看到了很多感覺是壓縮進去的東西
後面直接去逆向觀察發現他是一個twinBasic的東西(提取的ICON也長一樣)</p>
<p>(( 但好像這樣就可以看到了 真的是小丑:(</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="xml"><code><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">┌──(kali㉿kali)-[/media/sf_SHARED_FILE/flareon/04/origional]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">└─$ tail -c 2000 ../UnholyDragon-150.exe | strings</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">&#x3C;?</span><span style="--0:#85E89D;--1:#1E7734">xml</span><span style="--0:#B392F0;--1:#6F42C1"> version</span><span style="--0:#E1E4E8;--1:#24292E">=</span><span style="--0:#9ECBFF;--1:#032F62">"1.0"</span><span style="--0:#B392F0;--1:#6F42C1"> encoding</span><span style="--0:#E1E4E8;--1:#24292E">=</span><span style="--0:#9ECBFF;--1:#032F62">"UTF-8"</span><span style="--0:#B392F0;--1:#6F42C1"> standalone</span><span style="--0:#E1E4E8;--1:#24292E">=</span><span style="--0:#9ECBFF;--1:#032F62">"yes"</span><span style="--0:#E1E4E8;--1:#24292E">?></span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#85E89D;--1:#1E7734">assembly</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">xmlns</span><span style="--0:#E1E4E8;--1:#24292E">=</span><span style="--0:#9ECBFF;--1:#032F62">"urn:schemas-microsoft-com:asm.v1"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">manifestVersion</span><span style="--0:#E1E4E8;--1:#24292E">=</span><span style="--0:#9ECBFF;--1:#032F62">"1.0"</span><span style="--0:#E1E4E8;--1:#24292E">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#85E89D;--1:#1E7734">assemblyIdentity</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#B392F0;--1:#6F42C1">type</span><span style="--0:#E1E4E8;--1:#24292E">=</span><span style="--0:#9ECBFF;--1:#032F62">"win32"</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#B392F0;--1:#6F42C1">processorArchitecture</span><span style="--0:#E1E4E8;--1:#24292E">=</span><span style="--0:#9ECBFF;--1:#032F62">"*"</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#B392F0;--1:#6F42C1">name</span><span style="--0:#E1E4E8;--1:#24292E">=</span><span style="--0:#9ECBFF;--1:#032F62">"My_twinBASIC_Application"</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#B392F0;--1:#6F42C1">version</span><span style="--0:#E1E4E8;--1:#24292E">=</span><span style="--0:#9ECBFF;--1:#032F62">"1.0.0.0"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">/></span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">&#x3C;/</span><span style="--0:#85E89D;--1:#1E7734">assembly</span><span style="--0:#E1E4E8;--1:#24292E">></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="┌──(kali㉿kali)-[/media/sf_SHARED_FILE/flareon/04/origional]└─$ tail -c 2000 ../UnholyDragon-150.exe | strings<?xml version=&#x22;1.0&#x22; encoding=&#x22;UTF-8&#x22; standalone=&#x22;yes&#x22;?><assembly xmlns=&#x22;urn:schemas-microsoft-com:asm.v1&#x22; manifestVersion=&#x22;1.0&#x22;>  <assemblyIdentity     type=&#x22;win32&#x22;     processorArchitecture=&#x22;*&#x22;     name=&#x22;My_twinBASIC_Application&#x22;     version=&#x22;1.0.0.0&#x22;  /></assembly>"><div></div></button></div></figure></div>
<p>裡面逆進去是一些自解壓的邏輯和經過混淆的很多func
(下略N小時的逆向時間)</p>
</div>
</details>
<details data-callout="" data-callout-type="note" open>
<summary data-callout-title="">solution</summary>
<div data-callout-body="">
<p><strong>TL;DR autong提示說玩一玩就有flag了</strong>
想說在唬爛吧 然後他叫我看看檔案名稱</p>
<p>終於動念去把<code>UnholyDragon-150.exe</code>-><code>UnholyDragon.exe</code>
就跑出了1-154 差點把虛擬機搞沒
其中126-148都有在執行
但是150一樣開頭壞掉
(到這邊我還想說還是應該再逆一下嗎) (下略N小時逆向妙妙屋)</p>
<p>但其實一樣修一下開頭重新執行就有了flag了
但是中間學到了一些解壓縮的方法跟twinbasic語法 蠻好玩的 耶</p>
</div>
</details>
<h3 id="05">05</h3>
<details data-callout="" data-callout-type="quote" open>
<summary data-callout-title="">challenge</summary>
<div data-callout-body="">
<p></p>
<blockquote>
<p>I’m not here to tell you how to do your job or anything, given that you are a top notch computer scientist who has solved four challenges already, but NTFS is in the filename. Maybe, I don’t know, run it in windows on an NTFS file system?</p>
</blockquote>
<p>strings 看到一些有趣的東西</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">D:\a\_work\1\s\binaries\amd64ret\inc\optional</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">D:\a\_work\1\s\src\vctools\crt\vcruntime\src\eh\std_type_info.cpp</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">D:\a\_work\1\s\src\vctools\crt\vcruntime\src\internal\per_thread_data.cpp</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">minkernel\crts\ucrt\src\appcrt\misc\dbgrpt.cpp</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">minkernel\crts\ucrt\src\appcrt\stdio\_file.cpp</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">https://www.youtube.com/watch?v=dQw4w9WgXcQ&#x26;list=RDdQw4w9WgXcQ</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">C:\\Users\\flare\\Desktop\\challenge\\main.pdb</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="D:\a\_work\1\s\binaries\amd64ret\inc\optionalD:\a\_work\1\s\src\vctools\crt\vcruntime\src\eh\std_type_info.cppD:\a\_work\1\s\src\vctools\crt\vcruntime\src\internal\per_thread_data.cppminkernel\crts\ucrt\src\appcrt\misc\dbgrpt.cppminkernel\crts\ucrt\src\appcrt\stdio\_file.cpphttps://www.youtube.com/watch?v=dQw4w9WgXcQ&#x26;list=RDdQw4w9WgXcQC:\\Users\\flare\\Desktop\\challenge\\main.pdb"><div></div></button></div></figure></div>
<p>又是瑞克搖 ==
但最後那個感覺是要修pdb
然後題目提示是跟ntfs相關的東西</p>
<h4 id="ntfs-stream">NTFS stream</h4>
<p>然後另外去找了一下ntfs相關的背景知識還有之前AIS3馬師講到的再stream裡面藏東西的evade方法筆記</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Get-Item -Path .\ntfsm.exe -Stream *                                               15:59:45</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSPath        : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05\ntfsm.exe::$DATA</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSParentPath  : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSChildName   : ntfsm.exe::$DATA</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">FileName      : C:\flareon\05\ntfsm.exe</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Stream        : :$DATA</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Length        : 20151296</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSPath        : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05\ntfsm.exe:input</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSParentPath  : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSChildName   : ntfsm.exe:input</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Stream        : input</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Length        : 16</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSPath        : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05\ntfsm.exe:positi</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">               </span></span><span style="--0:#e1e4e8;--1:#24292e">on</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSParentPath  : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSChildName   : ntfsm.exe:position</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Stream        : position</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Length        : 8</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSPath        : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05\ntfsm.exe:state</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSParentPath  : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSChildName   : ntfsm.exe:state</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Stream        : state</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Length        : 8</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSPath        : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05\ntfsm.exe:transi</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">               </span></span><span style="--0:#e1e4e8;--1:#24292e">tions</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSParentPath  : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">PSChildName   : ntfsm.exe:transitions</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Stream        : transitions</span></div></div><div class="ec-line"><div class="code"><span style="--0:#e1e4e8;--1:#24292e">Length        : 8</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Get-Item -Path .\ntfsm.exe -Stream *                                               15:59:45PSPath        : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05\ntfsm.exe::$DATAPSParentPath  : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05PSChildName   : ntfsm.exe::$DATAFileName      : C:\flareon\05\ntfsm.exeStream        : :$DATALength        : 20151296PSPath        : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05\ntfsm.exe:inputPSParentPath  : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05PSChildName   : ntfsm.exe:inputStream        : inputLength        : 16PSPath        : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05\ntfsm.exe:positi               onPSParentPath  : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05PSChildName   : ntfsm.exe:positionStream        : positionLength        : 8PSPath        : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05\ntfsm.exe:statePSParentPath  : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05PSChildName   : ntfsm.exe:stateStream        : stateLength        : 8PSPath        : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05\ntfsm.exe:transi               tionsPSParentPath  : Microsoft.PowerShell.Core\FileSystem::C:\flareon\05PSChildName   : ntfsm.exe:transitionsStream        : transitionsLength        : 8"><div></div></button></div></figure></div>
<p>跟前面靜態逆出來的幾個關鍵參數有對上</p>
</div>
</details>
<details data-callout="" data-callout-type="note" open>
<summary data-callout-title="">solution</summary>
<div data-callout-body="">
<p></p>
<h3 id="靜態分析主要函數">靜態分析主要函數</h3>
<p>看到string裡面有個<code>input 16 characters</code>的檢查，順藤摸瓜找到主要的比較函式</p>
<ul>
<li><code>sub_14000c0b0</code>: 裡面依序設定了4個map: <code>state, input, position, transitions</code></li>
<li>逐字元讀取並設定<code>state</code></li>
<li>參考<code>jump table</code> (0x000140ca3b) 讀取出要比較的目標
<ul>
<li><strong>中間卡在這邊不知道怎麼去定位到具體的比較目標以及選項之間的樹狀關係</strong></li>
</ul>
</li>
<li>table會根據state進入不同的分支然後進行對應的字元比較並寫入新的state</li>
<li>把state寫入 NTFS ADS (sub_140FF1190)</li>
<li>執行shellcode 跑 create subprocess
<ul>
<li>沒搞好會登出電腦重開機QQ</li>
</ul>
</li>
<li>如果一連串都是對的會去跑flag的func<code>sub_14000b2a0</code>(但是首先還是需要知道那個16bits</li>
</ul>
<div class="mermaid">
  flowchart TD
   A[用戶執行程式] --> B[讀取 NTFS ADS]
   B --> C{第一次執行？}
   C -->|是| D[初始化]
   D --> E[exit]

   C -->|否| F{position &#x3C; 16？}
   
   F -->|Yes| G[繼續處理]
   G --> H[跳轉表查找]
   H --> I[state → 查表 → 代碼地址]
   I --> J[跳轉到該地址]
   J --> K[執行狀態處理代碼]
   K --> L{字元匹配？}

   L -->|Yes| M[新狀態，transitions++]
   L -->|No| N[ShellExecuteA → 進程爆炸]

   M --> O[position++]
   O --> P[更新 ADS]
   P --> Q[exit 0]

   F -->|No| R[檢查完成]
   R --> S{transitions == 16？}
   S -->|Yes| T["correct!" → exit 0]
   S -->|No| U["wrong!" → exit 1]
</div>
<details data-callout="" data-callout-type="example" open>
<summary data-callout-title="">舉第一個字元比較的例子</summary>
<div data-callout-body="">
<p>舉個例子第一個字的比較會是case 0
<code>jumptable 000000014000CA5A </code> 然後進去比較J/U/i三個不同的分支</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c"><code><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860241</span><span style="--0:#E1E4E8;--1:#24292E"> loc_140860241:                          ; CODE XREF: sub_14000C0B0</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">9AA</span><span style="--0:#E1E4E8;--1:#24292E">↑j</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860241</span><span style="--0:#E1E4E8;--1:#24292E"> rdtsc                                   ; jumptable </span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014000CA5A</span><span style="--0:#E1E4E8;--1:#24292E"> case </span><span style="--0:#79B8FF;--1:#005CC5">0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860243</span><span style="--0:#E1E4E8;--1:#24292E"> shl     rdx, </span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">20h</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860247</span><span style="--0:#E1E4E8;--1:#24292E"> or      rax, rdx</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014086024A</span><span style="--0:#E1E4E8;--1:#24292E"> mov     [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">var_680], rax</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860252</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860252</span><span style="--0:#E1E4E8;--1:#24292E"> loc_140860252:                          ; CODE XREF: sub_14000C0B0</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">8541CF</span><span style="--0:#E1E4E8;--1:#24292E">↓j</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860252</span><span style="--0:#E1E4E8;--1:#24292E"> rdtsc</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860254</span><span style="--0:#E1E4E8;--1:#24292E"> shl     rdx, </span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">20h</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860258</span><span style="--0:#E1E4E8;--1:#24292E"> or      rax, rdx</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014086025B</span><span style="--0:#E1E4E8;--1:#24292E"> mov     [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">var_678], rax</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860263</span><span style="--0:#E1E4E8;--1:#24292E"> mov     rax, [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">var_680]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014086026B</span><span style="--0:#E1E4E8;--1:#24292E"> mov     rcx, [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">var_678]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860273</span><span style="--0:#E1E4E8;--1:#24292E"> sub     rcx, rax</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860276</span><span style="--0:#E1E4E8;--1:#24292E"> mov     rax, rcx</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860279</span><span style="--0:#E1E4E8;--1:#24292E"> cmp     rax, </span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">12AD1659h</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">000000014086027</span><span style="--0:#F97583;--1:#BF3441">F</span><span style="--0:#E1E4E8;--1:#24292E"> jl      </span><span style="--0:#F97583;--1:#BF3441">short</span><span style="--0:#E1E4E8;--1:#24292E"> loc_140860252</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860281</span><span style="--0:#E1E4E8;--1:#24292E"> movzx   eax, [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">var_59368]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860286</span><span style="--0:#E1E4E8;--1:#24292E"> mov     [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">var_1D80C], al</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014086028D</span><span style="--0:#E1E4E8;--1:#24292E"> cmp     [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">var_1D80C], </span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">4Ah</span><span style="--0:#E1E4E8;--1:#24292E"> ; </span><span style="--0:#9ECBFF;--1:#032F62">'J'</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860295</span><span style="--0:#E1E4E8;--1:#24292E"> jz      </span><span style="--0:#F97583;--1:#BF3441">short</span><span style="--0:#E1E4E8;--1:#24292E"> loc_1408602CE</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0000000140860297</span><span style="--0:#E1E4E8;--1:#24292E"> cmp     [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">var_1D80C], </span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">55h</span><span style="--0:#E1E4E8;--1:#24292E"> ; </span><span style="--0:#9ECBFF;--1:#032F62">'U'</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">000000014086029</span><span style="--0:#F97583;--1:#BF3441">F</span><span style="--0:#E1E4E8;--1:#24292E"> jz      </span><span style="--0:#F97583;--1:#BF3441">short</span><span style="--0:#E1E4E8;--1:#24292E"> loc_1408602EF</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">00000001408602A1</span><span style="--0:#E1E4E8;--1:#24292E"> cmp     [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">var_1D80C], </span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">69h</span><span style="--0:#E1E4E8;--1:#24292E"> ; </span><span style="--0:#9ECBFF;--1:#032F62">'i'</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">00000001408602A9</span><span style="--0:#E1E4E8;--1:#24292E"> jz      </span><span style="--0:#F97583;--1:#BF3441">short</span><span style="--0:#E1E4E8;--1:#24292E"> loc_1408602AD</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">00000001408602AB</span><span style="--0:#E1E4E8;--1:#24292E"> jmp     </span><span style="--0:#F97583;--1:#BF3441">short</span><span style="--0:#E1E4E8;--1:#24292E"> loc_140860310</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".text:0000000140860241 loc_140860241:                          ; CODE XREF: sub_14000C0B0+9AA↑j.text:0000000140860241 rdtsc                                   ; jumptable 000000014000CA5A case 0.text:0000000140860243 shl     rdx, 20h.text:0000000140860247 or      rax, rdx.text:000000014086024A mov     [rsp+59398h+var_680], rax.text:0000000140860252.text:0000000140860252 loc_140860252:                          ; CODE XREF: sub_14000C0B0+8541CF↓j.text:0000000140860252 rdtsc.text:0000000140860254 shl     rdx, 20h.text:0000000140860258 or      rax, rdx.text:000000014086025B mov     [rsp+59398h+var_678], rax.text:0000000140860263 mov     rax, [rsp+59398h+var_680].text:000000014086026B mov     rcx, [rsp+59398h+var_678].text:0000000140860273 sub     rcx, rax.text:0000000140860276 mov     rax, rcx.text:0000000140860279 cmp     rax, 12AD1659h.text:000000014086027F jl      short loc_140860252.text:0000000140860281 movzx   eax, [rsp+59398h+var_59368].text:0000000140860286 mov     [rsp+59398h+var_1D80C], al.text:000000014086028D cmp     [rsp+59398h+var_1D80C], 4Ah ; &#x27;J&#x27;.text:0000000140860295 jz      short loc_1408602CE.text:0000000140860297 cmp     [rsp+59398h+var_1D80C], 55h ; &#x27;U&#x27;.text:000000014086029F jz      short loc_1408602EF.text:00000001408602A1 cmp     [rsp+59398h+var_1D80C], 69h ; &#x27;i&#x27;.text:00000001408602A9 jz      short loc_1408602AD.text:00000001408602AB jmp     short loc_140860310"><div></div></button></div></figure></div>
<p>那三個分支會設定不同的狀態然後最後都會跑到<code>140860310</code></p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000140860310</span><span style="--0:#E1E4E8;--1:#24292E"> loc_140860310:                          ; </span><span style="--0:#79B8FF;--1:#005CC5">CODE</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">XREF</span><span style="--0:#E1E4E8;--1:#24292E">: sub_14000C0B0</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">8541FB</span><span style="--0:#E1E4E8;--1:#24292E">↑j</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000140860310</span><span style="--0:#E1E4E8;--1:#24292E"> mov     [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">nShowCmd], </span><span style="--0:#79B8FF;--1:#005CC5">5</span><span style="--0:#E1E4E8;--1:#24292E">        ; nShowCmd</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000140860318</span><span style="--0:#E1E4E8;--1:#24292E"> mov     [rsp</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">59398h</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">lpDirectory], </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">     ; lpDirectory</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000140860321</span><span style="--0:#E1E4E8;--1:#24292E"> lea     r9, aCMsgHelloThere_3024        ; </span><span style="--0:#9ECBFF;--1:#032F62">" /c msg * Hello there, Hacker"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000140860328</span><span style="--0:#E1E4E8;--1:#24292E"> lea     r8, aCmdExe_3024                ; </span><span style="--0:#9ECBFF;--1:#032F62">"cmd.exe"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014086032F</span><span style="--0:#E1E4E8;--1:#24292E"> lea     rdx, aOpen_6196                 ; </span><span style="--0:#9ECBFF;--1:#032F62">"open"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000140860336</span><span style="--0:#E1E4E8;--1:#24292E"> xor     ecx, ecx                        ; hwnd</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000140860338</span><span style="--0:#E1E4E8;--1:#24292E"> call    cs:ShellExecuteA</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014086033E</span><span style="--0:#E1E4E8;--1:#24292E"> nop</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014086033F</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014086033F</span><span style="--0:#E1E4E8;--1:#24292E"> loc_14086033F:                          ; </span><span style="--0:#79B8FF;--1:#005CC5">CODE</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">XREF</span><span style="--0:#E1E4E8;--1:#24292E">: sub_14000C0B0</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">85421C</span><span style="--0:#E1E4E8;--1:#24292E">↑j</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014086033F</span><span style="--0:#E1E4E8;--1:#24292E">                                         ; sub_14000C0B0</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">85423D</span><span style="--0:#E1E4E8;--1:#24292E">↑j </span><span style="--0:#79B8FF;--1:#005CC5">...</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">.text:</span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">000000014086033F</span><span style="--0:#E1E4E8;--1:#24292E"> jmp     loc_140C685EE</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=".text:0000000140860310 loc_140860310:                          ; CODE XREF: sub_14000C0B0+8541FB↑j.text:0000000140860310 mov     [rsp+59398h+nShowCmd], 5        ; nShowCmd.text:0000000140860318 mov     [rsp+59398h+lpDirectory], 0     ; lpDirectory.text:0000000140860321 lea     r9, aCMsgHelloThere_3024        ; &#x22; /c msg * Hello there, Hacker&#x22;.text:0000000140860328 lea     r8, aCmdExe_3024                ; &#x22;cmd.exe&#x22;.text:000000014086032F lea     rdx, aOpen_6196                 ; &#x22;open&#x22;.text:0000000140860336 xor     ecx, ecx                        ; hwnd.text:0000000140860338 call    cs:ShellExecuteA.text:000000014086033E nop.text:000000014086033F.text:000000014086033F loc_14086033F:                          ; CODE XREF: sub_14000C0B0+85421C↑j.text:000000014086033F                                         ; sub_14000C0B0+85423D↑j ....text:000000014086033F jmp     loc_140C685EE"><div></div></button></div></figure></div>
</div>
</details>
<hr>
<p><strong>於是我們有個想法</strong>
<strong>1. 拿到跳轉表</strong>
<strong>2. 建立樹狀結構</strong>
<strong>3. 用DFS或是其他方法找到正確的路徑</strong></p>
<h5 id="釐清與逆向part1-跳轉表">釐清與逆向PART1. 跳轉表</h5>
<p>done, tbc</p>
<h5 id="釐清與逆向part2-生成fns-func裡面的字串比較">釐清與逆向PART2. 生成FNS (func裡面的字串比較)</h5>
<p>done, tbc</p>
<h5 id="釐清與逆向part3開搞dfs">釐清與逆向PART3.開搞DFS</h5>
<p>這邊做到一半 好累 之後再看看有沒有辦法自己搓出來</p>
</div>
</details>  </div> </article> </main> <footer data-astro-cid-sz7xmlte> <div class="footer-content" data-astro-cid-sz7xmlte> <div class="copyright" data-astro-cid-sz7xmlte>
&copy; 2025 Obsidian Blogger. All rights reserved.
</div> </div> </footer>  <script type="module" src="/blogs/_astro/BlogPost.astro_astro_type_script_index_0_lang.DbtG32J1.js"></script> </body> </html>